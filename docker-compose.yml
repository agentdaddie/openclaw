services:
  openclaw:
    image: coollabsio/openclaw:latest
    ports:
      - "${PORT:-8888}:8080"
    environment:
      # Provider + model (from .env)
      - OPENCLAW_PRIMARY_MODEL=${OPENCLAW_PRIMARY_MODEL}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - XAI_API_KEY=${XAI_API_KEY}
      - GROQ_API_KEY=${GROQ_API_KEY}
      - MISTRAL_API_KEY=${MISTRAL_API_KEY}
      - CEREBRAS_API_KEY=${CEREBRAS_API_KEY}
      - VENICE_API_KEY=${VENICE_API_KEY}
      - MOONSHOT_API_KEY=${MOONSHOT_API_KEY}
      - KIMI_API_KEY=${KIMI_API_KEY}
      - MINIMAX_API_KEY=${MINIMAX_API_KEY}
      - ZAI_API_KEY=${ZAI_API_KEY}
      - AI_GATEWAY_API_KEY=${AI_GATEWAY_API_KEY}
      - OPENCODE_API_KEY=${OPENCODE_API_KEY}
      - SYNTHETIC_API_KEY=${SYNTHETIC_API_KEY}
      - COPILOT_GITHUB_TOKEN=${COPILOT_GITHUB_TOKEN}
      - XIAOMI_API_KEY=${XIAOMI_API_KEY}
      - OLLAMA_BASE_URL=${OLLAMA_BASE_URL}
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_REGION=${AWS_REGION}
      - OPENCLAW_CUSTOM_CONFIG=/app/config/openclaw.json

      # Telegram
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - TELEGRAM_DM_POLICY=${TELEGRAM_DM_POLICY}
      - TELEGRAM_ALLOW_FROM=${TELEGRAM_ALLOW_FROM}

      # Auth
      - AUTH_USERNAME=${AUTH_USERNAME}
      - AUTH_PASSWORD=${AUTH_PASSWORD}
      - OPENCLAW_GATEWAY_TOKEN=${OPENCLAW_GATEWAY_TOKEN}
      # Browser sidecar
      - BROWSER_CDP_URL=http://browser:9223
      - BROWSER_DEFAULT_PROFILE=openclaw
      - BROWSER_EVALUATE_ENABLED=true
      # Hooks (optional)
      # - HOOKS_ENABLED=true
      # - HOOKS_TOKEN=my-hook-secret
    volumes:
      - openclaw-data:/data
      - ./MEMORY.md:/data/workspace/MEMORY.md
      # Optional: custom JSON config for complex settings (groups, plugins, etc.)
      - ./my-openclaw.json:/app/config/openclaw.json
    depends_on:
      - browser
    restart: unless-stopped

  browser:
    image: coollabsio/openclaw-browser:latest
    # No port exposure needed â€” proxied via openclaw at /browser/
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Etc/UTC
      - CHROME_CLI=--remote-debugging-port=9222
    volumes:
      - browser-data:/config
    shm_size: 2g
    restart: unless-stopped

volumes:
  openclaw-data:
  browser-data:
